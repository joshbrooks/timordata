{% extends "object_list.html" %}
{% load i18n %}
{% load render_table from django_tables2 %}
{% load crispy_forms_tags %}
{% block title %}{{block.super}} Organizations {% endblock title %}
{% block script %}
    {{block.super}}
<script type="text/javascript" src="{{ STATIC_URL }}leaflet-organizationplace.js"></script>
<script>
    {% autoescape off %}
    var object_list = {{object_index}}
{% endautoescape  %}
</script>


<script>
    $(document).ready(function() {

        // Directly change the URL when the 'select' box for organization is used
        $('[name=org]').on('select2:select',  function (e) {
            window.event = e;
            console.log("select2:select", e);
            window.location.hash = 'object='+$(e.target).val();

        });


        $(document).on('click', '[data-largeimage]', function () {
            var i = $('#imagemodal');
            i.find('img').attr('src', ($(this).data('largeimage')));
            i.find('.description').text($(this).attr('alt'));
            i.modal()
        });

    });
</script>
{% endblock script %}

{% block containerclass %}container-fluid{% endblock %}

{% block leftsidelist %}

    <form class="search-form form-horizontal">
        <div class="container-fluid">
            <div class="row">

    <div class="form-group">
        <label for="search-form-activities" class="col-sm-3 control-label">Activities</label>
        <div class="col-sm-9">
            <select style="width:100%;" id="search-form-activities" class="auto-select2" name="q" multiple=multiple>{% for a in filters.act %}
                <option value="{{a.path}}" {% if a.path in activefilters %}selected{%endif%}>{{a}}</option> {% endfor %}
            </select>
        </div>
    </div>

    <div class="form-group">
        <label for="search-form-beneficiaries" class="col-sm-3 control-label">Beneficiaries</label>
        <div class="col-sm-9">
            <select style="width:100%;" id="search-form-beneficiaries" class="auto-select2" name="q" multiple=multiple>{% for a in filters.ben %}
                <option value="{{a.path}}" {% if a.path in activefilters %}selected{%endif%}>{{a}}</option> {% endfor %}
            </select>
        </div>
    </div>

    <div class="form-group">
        <label for="search-form-sectors" class="col-sm-3 control-label">Sectors</label>
        <div class="col-sm-9">
            <select style="width:100%;" id="search-form-sectors" class="auto-select2" name="q" multiple=multiple>{% for a in filters.inv %}
                <option value="{{a.path}}" {% if a.path in activefilters %}selected{%endif%}>{{a}}</option> {% endfor %}
            </select>
        </div>
    </div>

    <div class="form-group">
        <label for="search-form-district" class="col-sm-3 control-label">Project in</label>
        <div class="col-sm-9">
            <select style="width:100%;" id="search-form-district" class="auto-select2" name="q" multiple=multiple>{% for a in filters.district %}
                <option value="{{a.value}}" {% if a.value in activefilters %}selected{%endif%}>{{a.label}}</option> {% endfor %}
            </select>
        </div>
    </div>

    <div class="form-group">
        <label for="search-form-office" class="col-sm-3 control-label">Office in</label>
        <div class="col-sm-9">
            <select style="width:100%;" id="search-form-office" class="auto-select2" name="q" multiple=multiple>{% for a in filters.org_location %}
                <option value="{{a.value}}" {% if a.value in activefilters %}selected{%endif%}>{{a.label}}</option> {% endfor %}
            </select>
        </div>
    </div>

    <div class="form-group">
        <label for="search-form-orgtype" class="col-sm-3 control-label">Organization Type</label>
        <div class="col-sm-9">
            <select style="width:100%;" id="search-form-orgtype" class="auto-select2" name="q" multiple=multiple>{% for a in filters.type %}
                <option value="{{a.value}}" {% if a.value in activefilters %}selected{%endif%}>{{a.label}}</option> {% endfor %}
            </select>
        </div>
    </div>

    <div class="clearfix"></div>

    <div class="col-sm-12">
<label class="radio-inline">
<input type="radio" name="q" id="inlineRadio1" value="active.true" {% if "active.true" in activefilters %} checked=checked {%endif %}> Active only
</label>
</div>
<div class="col-sm-12">
<label class="radio-inline">
<input type="radio" name="q" id="inlineRadio2" value="active.false" {% if "active.false" in activefilters %} checked=checked {%endif %}> Inactive organizations only
</label>
</div>
<div class="col-sm-12">
<label class="radio-inline">
<input type="radio" name="q" id="inlineRadio3" value="active.any" {% if "active.any" in activefilters %} checked=checked {%endif %}> Active and Inactive
</label>
</div>
<button class="btn btn-block">Search</button>

</form>


<div>
    <form class="search-form form-horizontal">
        <div class="container-fluid">
            <div class="row">
    <div class="form-group">
        <label for="search-form-organization"  class="col-sm-3 control-label">Go to</label>
        <div class="col-sm-9">
            <select style="width:100%" name="org" id="search-form-organization" data-selecturl="/selecttwo/nhdb/organization/name/icontains/" multiple="multiple">
                {% for i in organization %}
                <option value="{{i.pk}}" selected>{{i}}</option>
                {% endfor %}
            </select>
        </div>
    </div>
                </div>
            </div>
        </form>
    </div>
</div>
</div>


{% endblock %}

{% block objectlist %}
        <div id="object-list" class="collapse in"><div>
            <p>Note: emails are encrypted to help prevent the organizations listed from spam.</p>
    <button class="showliame">Show emails</button>
                    <div class="col col-lg-12 col-xs-12" id="actions-container">
            <a href="table/?{{ request.GET.urlencode }}" class="btn btn-default btn-sm">Contact list</a>
            <a href="xls/?{{ request.GET.urlencode }}" class="btn btn-default btn-sm">Contact list as Excel download</a>
        </div>
    {% render_table table %}</div>
</div>{% endblock %}


{% block dashboard %}
    <h4>Organization Search</h4>
     <p><strong>{{object_list.count}} Organizations</strong> found with this search</p>

     <div class="container-fluid"><div class="row">

     {% for category, tag_count in dashboard.items %}<div class="col col-sm-6 col-xs-12 col-md-4 col-lg-3">
             <table class="table table-condensed">
            <caption>{{category}}</caption>
            <tbody>
        {% for tag, count in tag_count.items %}

            <tr>{% if tag.path in activefilters %}
                <td><strong>{{tag}}</strong></td> <td><strong>{{count}}</strong></td>
                {% else %}
                <td>{{tag}}</td> <td>{{count}}</td>
                {% endif %}
            </tr>

     {% endfor %}

                    </tbody>
        </table>
     </div>{% endfor %}</div></div>

{% endblock %}
